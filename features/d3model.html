<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D MODELS</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="feature.css">
</head>

<body>

    <div id="head_container">
        <div id="heading">
            <img src="../imgs/Ph.png" alt="logo" id="logo">
            <h1 id="title">Physic Hell</h1>
        </div>
        <button id="menu_btn">‚ò∞</button>
        <div id="menu">
            <a href="#">home</a>
            <a href="#">Dashboard</a>
            <a href="#">profile</a>
            <a href="#">settings</a>
            <a href="#" id="logout">logout ‚Üí</a>
        </div>
    </div>

    <div id="f_container">
        <div class="content">

            <div id="head">
                <button id="back_btn">‚Üê</button>
                <h2>3D MODELS</h2>
            </div>

            <!-- üî• Controls Area (UI will appear here) -->
            <div id="controls_area"></div>

            <!-- üî• Rendering Area (ONLY canvas goes here) -->
            <div id="model_area"></div>

            <div id="d_options">
                <select id="model_select"></select>
            </div>

        </div>
    </div>

    <script src="../script.js"></script>
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>

        // ================= ENGINE SETUP =================

        const modelArea = document.getElementById("model_area");
        const controlsArea = document.getElementById("controls_area");
        const modelSelect = document.getElementById("model_select");

        const width = 260;
        const height = 350;

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x111111);

        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        camera.position.set(6, 6, 6);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(width, height);
        modelArea.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        const light = new THREE.PointLight(0xffffff, 1.5);
        light.position.set(10, 10, 10);
        scene.add(light);

        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);

        const gridHelper = new THREE.GridHelper(20, 20);
        scene.add(gridHelper);

        let activeAnimation = null;

        function animate() {
            requestAnimationFrame(animate);
            if (activeAnimation) activeAnimation();
            controls.update();
            renderer.render(scene, camera);
        }
        animate();


        // ================= CLEAR SCENE =================

        function clearScene() {

            scene.children = scene.children.filter(obj =>
                obj === light ||
                obj === ambientLight ||
                obj === gridHelper
            );

            // controlsArea.innerHTML = "";
            activeAnimation = null;
        }


        // ================= MODEL 1: COORDINATE SYSTEM =================

        function buildCoordinateSystem() {
            clearScene();
            const axes = new THREE.AxesHelper(5);
            scene.add(axes);
        }


        // ================= MODEL 2: VECTOR ADDITION =================

        function buildVectorAddition() {

            clearScene();

            controlsArea.innerHTML = `
                <p>Vector A (x,y,z)</p>
                <input type="number" id="ax" value="3">
                <input type="number" id="ay" value="2">
                <input type="number" id="az" value="1">

                <p>Vector B (x,y,z)</p>
                <input type="number" id="bx" value="1">
                <input type="number" id="by" value="2">
                <input type="number" id="bz" value="3">

                <button id="update_vector">Update</button>
            `;

            function drawVectors() {

                clearScene();

                const ax = parseFloat(document.getElementById("ax").value);
                const ay = parseFloat(document.getElementById("ay").value);
                const az = parseFloat(document.getElementById("az").value);

                const bx = parseFloat(document.getElementById("bx").value);
                const by = parseFloat(document.getElementById("by").value);
                const bz = parseFloat(document.getElementById("bz").value);

                const origin = new THREE.Vector3(0, 0, 0);

                const v1 = new THREE.Vector3(ax, ay, az);
                const v2 = new THREE.Vector3(bx, by, bz);
                const result = new THREE.Vector3().addVectors(v1, v2);

                scene.add(new THREE.AxesHelper(5));

                function addArrow(vec, start, color) {
                    if (vec.length() === 0) return;
                    const arrow = new THREE.ArrowHelper(
                        vec.clone().normalize(),
                        start,
                        vec.length(),
                        color
                    );
                    scene.add(arrow);
                }

                addArrow(v1, origin, 0xff0000);
                addArrow(v2, v1, 0x0000ff);
                addArrow(result, origin, 0x00ff00);
            }

            document.getElementById("update_vector")
                .addEventListener("click", drawVectors);

            drawVectors();
        }


        // ================= MODEL 3: PROJECTILE =================

        function buildProjectileMotion() {

            clearScene();

            // ================= UI =================
            controlsArea.innerHTML = `
        <p>Velocity (m/s)</p>
        <input type="number" id="velocity" value="20">

        <p>Angle (degrees)</p>
        <input type="number" id="angle" value="45">

        <p>Gravity g (m/s¬≤)</p>
        <input type="number" id="gravity" value="9.8">

        <button id="launch">Launch</button>
    `;

            // ================= Ball =================
            const ball = new THREE.Mesh(
                new THREE.SphereGeometry(0.3, 16, 16),
                new THREE.MeshStandardMaterial({ color: 0xffff00 })
            );

            scene.add(ball);

            const scale = 0.1; // visualization scaling
            let time = 0;

            function launch() {

                const velocity = parseFloat(document.getElementById("velocity").value);
                const angle = parseFloat(document.getElementById("angle").value) * Math.PI / 180;
                const g = parseFloat(document.getElementById("gravity").value);

                time = 0;
                ball.position.set(0, 0, 0);

                activeAnimation = function () {

                    time += 0.05;

                    const x = velocity * Math.cos(angle) * time;
                    const y = velocity * Math.sin(angle) * time - 0.5 * g * time * time;

                    if (y < 0) {
                        activeAnimation = null;
                        return;
                    }

                    ball.position.set(
                        x * scale,
                        y * scale,
                        0
                    );
                };
            }

            document.getElementById("launch")
                .addEventListener("click", launch);

            launch();
        }

        // ================= MODEL 4: SHM =================

        function buildSHM() {

            clearScene();

            const mass = new THREE.Mesh(
                new THREE.BoxGeometry(0.6, 0.6, 0.6),
                new THREE.MeshStandardMaterial({ color: 0x00ffff })
            );

            scene.add(mass);

            let t = 0;
            activeAnimation = function () {
                t += 0.05;
                mass.position.x = 3 * Math.cos(2 * t);
            };
        }


        // ================= MODEL 5: CIRCULAR MOTION =================

        function buildCircularMotion() {

            clearScene();

            const particle = new THREE.Mesh(
                new THREE.SphereGeometry(0.4, 16, 16),
                new THREE.MeshStandardMaterial({ color: 0xff00ff })
            );

            scene.add(particle);

            let angle = 0;
            const radius = 4;

            activeAnimation = function () {
                angle += 0.02;
                particle.position.x = radius * Math.cos(angle);
                particle.position.z = radius * Math.sin(angle);
            };
        }


        // ================= REGISTRY =================

        const models = [
            { id: "coords", name: "3D Coordinate System", build: buildCoordinateSystem },
            { id: "vector", name: "Vector Addition", build: buildVectorAddition },
            { id: "projectile", name: "Projectile Motion", build: buildProjectileMotion },
            { id: "shm", name: "Simple Harmonic Motion", build: buildSHM },
            { id: "circular", name: "Circular Motion", build: buildCircularMotion }
        ];

        models.forEach(model => {
            const option = document.createElement("option");
            option.value = model.id;
            option.textContent = model.name;
            modelSelect.appendChild(option);
        });

        modelSelect.addEventListener("change", () => {

            controlsArea.innerHTML = "";   // clear UI safely here

            const selected = models.find(m => m.id === modelSelect.value);
            if (selected) selected.build();
        });


        models[0].build();

    </script>

</body>

</html>
